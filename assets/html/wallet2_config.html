<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <meta charset="UTF-8">
  <title>WalletV2 configuration</title>
<style>
  .form_item{
      margin-top: 10px;
  }
  .form_number{
      width: 50px;
  }
</style>
  <script>
    // wallet v2
    var wcc = undefined;
    var wbc = undefined;
    var cbc = undefined;

    const setForm = (config) => {
      wcc.val(config.walletCreditCard);
      wbc.val(config.walletBancomat);
      cbc.val(config.citizenBancomat);
    }

    const updateConfig = () => {
      const config = {
        walletBancomat: parseInt(wbc.val(),10),
        walletCreditCard: parseInt(wcc.val(),10),
        citizenBancomat: parseInt(cbc.val(),10),
      }
      $.ajax({
        type: 'POST',
        url: "/walletv2/config",
        data: JSON.stringify(config),
        success: function(data) { setForm(data); alert("done! refresh your wallet!") },
        contentType: "application/json",
        dataType: 'json'
      });
    }

    const resetConfig = () => {
      $.getJSON("/walletv2/reset", function(data) {
          setForm(data);
        }
      );
    }

    const initWalletV2 = () => {
      wcc = $("#walletCreditCard");
      wbc = $("#walletBancomat");
      cbc = $("#citizenBancomat");
      $.getJSON("/walletv2/config", function(data) {
          setForm(data);
        }
      );
    }

    var awardPeriodsPreset;
    const initBPD = () => {
      wcc = $("#walletCreditCard");
      awardPeriodsPreset = $("#awardPeriodsPreset");
      $.getJSON("/bonus/bpd/award/periods/presets", function(presets) {
        presets.forEach(p => {
          awardPeriodsPreset.append(new Option(p.replace(".json",""), p));
        });
        }
      );
    }

    const updateAwardPeriods = () => {
      $.ajax({
        type: 'POST',
        url: "/bonus/bpd/award/periods/presets/"+ awardPeriodsPreset.val(),
        data: JSON.stringify({}),
        success: function() {alert(`${awardPeriodsPreset.val()} flushed!`) }
      });
    }

    $(document).ready(function() {
      initWalletV2();
      initBPD();
    });
  </script>
</head>
<body>

<table style="padding:16px;border: 1px solid black;">
  <tr>
    <td colspan="2">
      <b>WalletV2 configuration</b>
    </td>
  </tr>
  <tr>
  <tr class="form_item">
    <td><label>wallet Credit Card</label></td>
    <td><input type="number" min="0" class="form_number" id="walletCreditCard"/>
  </tr>

  <tr class="form_item">
    <td><label>wallet Bancomat</label></td>
    <td><input type="number" min="0" class="form_number" id="walletBancomat"/></td>
  </tr>

  <tr class="form_item">
    <td><label>citizen Bancomat (pans)</label></td>
    <td><input type="number" min="0" class="form_number" id="citizenBancomat"/></td>
  </tr>
  <tr>
    <td colspan="2">
      <button value="update" onclick="updateConfig()">flush</button>
    </td>
  </tr>
  <tr>
    <td colspan="2">
      <button value="reset" onclick="resetConfig()">reset</button>
    </td>
  </tr>
</table>

<table style="padding:16px;border: 1px solid black; margin-top: 20px;">
  <tr>
    <td colspan="2">
      <b>BPD configuration</b>
    </td>
  </tr>
  <tr>
    <td colspan="2">
      <i>place your json preset into /assets/bpd/award/periods</i>
    </td>
  </tr>

  <tr class="form_item">
    <td><label>award periods</label></td>
    <td><select id="awardPeriodsPreset" style="width: 100px;"></select></td>
  </tr>
  <tr>
    <td colspan="2">
      <button value="reset" onclick="updateAwardPeriods()">flush</button>
    </td>
  </tr>
</table>
</body>
</html>